<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°zmir Konum Otomatik Tamamlama Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-title {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            min-height: 100px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .info { color: #3498db; }
        .warning { color: #f39c12; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">ğŸ—ºï¸ Ä°zmir Konum Otomatik Tamamlama Test Sistemi</h1>
        
        <div class="test-section">
            <h3>ğŸ“ CSV Veri Testi</h3>
            <button class="test-button" onclick="testCSVData()">CSV DosyasÄ±nÄ± Test Et</button>
            <button class="test-button" onclick="testLocationParsing()">Konum Parsing Test</button>
            <div id="csv-results" class="result-box">Test sonuÃ§larÄ± burada gÃ¶rÃ¼necek...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ” Arama AlgoritmasÄ± Testi</h3>
            <button class="test-button" onclick="testSearchAlgorithm()">Arama Testi</button>
            <button class="test-button" onclick="testPerformance()">Performans Testi</button>
            <div id="search-results" class="result-box">Arama sonuÃ§larÄ± burada gÃ¶rÃ¼necek...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š Koordinat DoÄŸrulama Testi</h3>
            <button class="test-button" onclick="testCoordinateValidation()">Koordinat DoÄŸrula</button>
            <button class="test-button" onclick="testZoomFunctionality()">Zoom Fonksiyonu Test</button>
            <div id="coordinate-results" class="result-box">Koordinat sonuÃ§larÄ± burada gÃ¶rÃ¼necek...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ React Entegrasyon Testi</h3>
            <a href="http://localhost:3000/bag-evi" target="_blank" class="test-button">BaÄŸ Evi SayfasÄ±nÄ± AÃ§</a>
            <button class="test-button" onclick="testReactIntegration()">Entegrasyon KontrolÃ¼</button>
            <div id="react-results" class="result-box">React entegrasyon sonuÃ§larÄ± burada gÃ¶rÃ¼necek...</div>
        </div>
    </div>

    <script>
        let csvData = [];
        
        // TÃ¼rkÃ§e karakterleri normalize etme fonksiyonu
        function normalizeText(text) {
            return text
                .toLowerCase()
                .normalize('NFD') // Unicode normalize
                .replace(/[\u0300-\u036f]/g, '') // AksanlarÄ± kaldÄ±r
                .replace(/Ã§/g, 'c')
                .replace(/ÄŸ/g, 'g')
                .replace(/Ä±/g, 'i')
                .replace(/Ã¶/g, 'o')
                .replace(/ÅŸ/g, 's')
                .replace(/Ã¼/g, 'u')
                .trim();
        }
        
        // CSV dosyasÄ±nÄ± test et
        async function testCSVData() {
            const resultDiv = document.getElementById('csv-results');
            resultDiv.innerHTML = 'â³ CSV dosyasÄ± yÃ¼kleniyor...';
            
            try {
                const response = await fetch('http://localhost:3000/merkez_koordinatlar.csv');
                const csvText = await response.text();
                
                if (!csvText) {
                    throw new Error('CSV dosyasÄ± boÅŸ');
                }
                
                // CSV'yi parse et
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                
                csvData = lines.slice(1).map(line => {
                    const values = line.split(',');
                    return {
                        ilce: values[0],
                        tur: values[1],
                        ad: values[2],
                        dosya: values[3],
                        longitude: parseFloat(values[4]),
                        latitude: parseFloat(values[5])
                    };
                }).filter(item => item.longitude && item.latitude);
                
                let result = `âœ… CSV baÅŸarÄ±yla yÃ¼klendi!\n`;
                result += `ğŸ“Š Toplam kayÄ±t: ${csvData.length}\n`;
                result += `ğŸ“ Ä°lÃ§e sayÄ±sÄ±: ${new Set(csvData.map(d => d.ilce)).size}\n`;
                result += `ğŸ˜ï¸ Mahalle sayÄ±sÄ±: ${csvData.filter(d => d.tur === 'MAHALLE').length}\n`;
                result += `ğŸ¢ Ä°lÃ§e merkezi sayÄ±sÄ±: ${csvData.filter(d => d.tur === 'Ä°LÃ‡E').length}\n\n`;
                
                // Ä°lk 5 kaydÄ± gÃ¶ster
                result += `ğŸ“‹ Ä°lk 5 kayÄ±t:\n`;
                csvData.slice(0, 5).forEach((item, index) => {
                    result += `${index + 1}. ${item.tur}: ${item.ad}, ${item.ilce} (${item.latitude}, ${item.longitude})\n`;
                });
                
                resultDiv.innerHTML = result;
                resultDiv.className = 'result-box success';
                
            } catch (error) {
                resultDiv.innerHTML = `âŒ CSV yÃ¼kleme hatasÄ±: ${error.message}`;
                resultDiv.className = 'result-box error';
            }
        }
        
        // Konum parsing test et
        function testLocationParsing() {
            const resultDiv = document.getElementById('csv-results');
            
            if (csvData.length === 0) {
                resultDiv.innerHTML = 'âš ï¸ Ã–nce CSV dosyasÄ±nÄ± yÃ¼kleyin!';
                return;
            }
            
            let result = `ğŸ” Parsing doÄŸrulama sonuÃ§larÄ±:\n\n`;
            
            // Koordinat aralÄ±ÄŸÄ± kontrolÃ¼ (Ä°zmir iÃ§in)
            const invalidCoords = csvData.filter(item => 
                item.latitude < 38.0 || item.latitude > 39.0 ||
                item.longitude < 26.0 || item.longitude > 28.0
            );
            
            if (invalidCoords.length > 0) {
                result += `âš ï¸ Ä°zmir dÄ±ÅŸÄ± koordinatlar (${invalidCoords.length} adet):\n`;
                invalidCoords.slice(0, 3).forEach(item => {
                    result += `- ${item.ad}, ${item.ilce}: ${item.latitude}, ${item.longitude}\n`;
                });
                result += '\n';
            } else {
                result += `âœ… TÃ¼m koordinatlar Ä°zmir sÄ±nÄ±rlarÄ± iÃ§inde\n\n`;
            }
            
            // Duplicate kontrol
            const seen = new Set();
            const duplicates = csvData.filter(item => {
                const key = `${item.ilce}-${item.ad}`;
                if (seen.has(key)) return true;
                seen.add(key);
                return false;
            });
            
            result += `ğŸ”„ Duplicate kayÄ±t: ${duplicates.length} adet\n`;
            result += `ğŸ“ Ortalama enlem: ${(csvData.reduce((a, b) => a + b.latitude, 0) / csvData.length).toFixed(4)}\n`;
            result += `ğŸ“ Ortalama boylam: ${(csvData.reduce((a, b) => a + b.longitude, 0) / csvData.length).toFixed(4)}\n`;
            
            resultDiv.innerHTML = result;
        }
        
        // Arama algoritmasÄ± test et
        function testSearchAlgorithm() {
            const resultDiv = document.getElementById('search-results');
            
            if (csvData.length === 0) {
                resultDiv.innerHTML = 'âš ï¸ Ã–nce CSV dosyasÄ±nÄ± yÃ¼kleyin!';
                return;
            }
            
            const testQueries = ['kar', 'bor', 'kon', 'men', 'bay', 'Ã§eÅŸ', 'Ã¶demiÅŸ', 'gÃ¼zelbahÃ§e', 'bostanlÄ±'];
            let result = `ğŸ” Arama algoritmasÄ± test sonuÃ§larÄ± (TÃ¼rkÃ§e karakter destekli):\n\n`;
            
            testQueries.forEach(query => {
                const startTime = performance.now();
                
                const filtered = csvData.filter(location => {
                    const normalizedSearchTerm = normalizeText(query);
                    const normalizedLocationName = normalizeText(location.ad);
                    const normalizedDistrictName = normalizeText(location.ilce);
                    
                    const nameMatch = normalizedLocationName.includes(normalizedSearchTerm);
                    const districtMatch = normalizedDistrictName.includes(normalizedSearchTerm);
                    
                    return nameMatch || districtMatch;
                }).slice(0, 5);
                
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);
                
                result += `"${query}" â†’ ${filtered.length} sonuÃ§ (${duration}ms)\n`;
                filtered.forEach(item => {
                    result += `  - ${item.tur}: ${item.ad}, ${item.ilce}\n`;
                });
                result += '\n';
            });
            
            resultDiv.innerHTML = result;
        }
        
        // Performans testi
        function testPerformance() {
            const resultDiv = document.getElementById('search-results');
            
            if (csvData.length === 0) {
                resultDiv.innerHTML = 'âš ï¸ Ã–nce CSV dosyasÄ±nÄ± yÃ¼kleyin!';
                return;
            }
            
            let result = `âš¡ Performans test sonuÃ§larÄ±:\n\n`;
            
            // 100 arama iÅŸlemi
            const queries = ['a', 'ka', 'kar', 'karÅŸ', 'karÅŸÄ±', 'karÅŸÄ±y', 'karÅŸÄ±ya', 'karÅŸÄ±yak', 'karÅŸÄ±yaka'];
            const iterations = 100;
            
            const startTime = performance.now();
            
            for (let i = 0; i < iterations; i++) {
                queries.forEach(query => {
                    csvData.filter(location => {
                        const normalizedSearchTerm = normalizeText(query);
                        const normalizedLocationName = normalizeText(location.ad);
                        const normalizedDistrictName = normalizeText(location.ilce);
                        
                        const nameMatch = normalizedLocationName.includes(normalizedSearchTerm);
                        const districtMatch = normalizedDistrictName.includes(normalizedSearchTerm);
                        
                        return nameMatch || districtMatch;
                    }).slice(0, 10);
                });
            }
            
            const endTime = performance.now();
            const totalTime = endTime - startTime;
            const avgTime = totalTime / (iterations * queries.length);
            
            result += `ğŸ¯ ${iterations * queries.length} arama iÅŸlemi\n`;
            result += `â±ï¸ Toplam sÃ¼re: ${totalTime.toFixed(2)}ms\n`;
            result += `ğŸ“Š Ortalama arama sÃ¼resi: ${avgTime.toFixed(3)}ms\n`;
            result += `ğŸš€ Saniyede arama sayÄ±sÄ±: ${(1000 / avgTime).toFixed(0)}\n\n`;
            
            if (avgTime < 1) {
                result += `âœ… Performans mÃ¼kemmel! (< 1ms)\n`;
            } else if (avgTime < 5) {
                result += `âœ… Performans iyi! (< 5ms)\n`;
            } else {
                result += `âš ï¸ Performans optimizasyonu gerekebilir (> 5ms)\n`;
            }
            
            resultDiv.innerHTML = result;
        }
        
        // Koordinat doÄŸrulama
        function testCoordinateValidation() {
            const resultDiv = document.getElementById('coordinate-results');
            
            if (csvData.length === 0) {
                resultDiv.innerHTML = 'âš ï¸ Ã–nce CSV dosyasÄ±nÄ± yÃ¼kleyin!';
                return;
            }
            
            // BazÄ± bilinen konumlarÄ± test et
            const knownLocations = [
                { name: 'KARÅIYAKA', expectedLat: 38.46, expectedLng: 27.10 },
                { name: 'BORNOVA', expectedLat: 38.47, expectedLng: 27.22 },
                { name: 'KONAK', expectedLat: 38.42, expectedLng: 27.14 }
            ];
            
            let result = `ğŸ“ Koordinat doÄŸrulama sonuÃ§larÄ±:\n\n`;
            
            knownLocations.forEach(known => {
                const found = csvData.find(item => 
                    item.ilce.includes(known.name) || item.ad.includes(known.name)
                );
                
                if (found) {
                    const latDiff = Math.abs(found.latitude - known.expectedLat);
                    const lngDiff = Math.abs(found.longitude - known.expectedLng);
                    
                    result += `ğŸ¯ ${known.name}:\n`;
                    result += `  Bulundu: ${found.ad}, ${found.ilce}\n`;
                    result += `  Koordinat: ${found.latitude}, ${found.longitude}\n`;
                    result += `  Beklenen: ${known.expectedLat}, ${known.expectedLng}\n`;
                    result += `  Fark: ${latDiff.toFixed(4)}, ${lngDiff.toFixed(4)}\n`;
                    
                    if (latDiff < 0.1 && lngDiff < 0.1) {
                        result += `  âœ… Koordinat doÄŸru\n\n`;
                    } else {
                        result += `  âš ï¸ Koordinat farkÄ± bÃ¼yÃ¼k\n\n`;
                    }
                } else {
                    result += `âŒ ${known.name} bulunamadÄ±\n\n`;
                }
            });
            
            resultDiv.innerHTML = result;
        }
        
        // Zoom fonksiyonu test
        function testZoomFunctionality() {
            const resultDiv = document.getElementById('coordinate-results');
            
            let result = `ğŸ” Zoom fonksiyonu test sonuÃ§larÄ±:\n\n`;
            
            // Test koordinatlarÄ±
            const testCoords = [
                { name: 'Ä°zmir Merkez', lat: 38.4237, lng: 27.1428, expectedZoom: 15 },
                { name: 'KarÅŸÄ±yaka', lat: 38.4667, lng: 27.1000, expectedZoom: 16 },
                { name: 'Bornova', lat: 38.4667, lng: 27.2167, expectedZoom: 16 }
            ];
            
            testCoords.forEach(coord => {
                result += `ğŸ“ ${coord.name} zoom testi:\n`;
                result += `  Koordinat: ${coord.lat}, ${coord.lng}\n`;
                result += `  Zoom seviyesi: ${coord.expectedZoom}\n`;
                result += `  âœ… Zoom fonksiyonu Ã§aÄŸrÄ±labilir\n\n`;
            });
            
            result += `ğŸ’¡ GerÃ§ek zoom testi React sayfasÄ±nda yapÄ±lmalÄ±dÄ±r.\n`;
            result += `ğŸ”— http://localhost:3000/bag-evi sayfasÄ±nÄ± ziyaret edin.\n`;
            
            resultDiv.innerHTML = result;
        }
        
        // React entegrasyon testi
        function testReactIntegration() {
            const resultDiv = document.getElementById('react-results');
            
            let result = `âš›ï¸ React entegrasyon kontrol listesi:\n\n`;
            
            // Dosya varlÄ±k kontrolÃ¼
            const requiredFiles = [
                '/merkez_koordinatlar.csv',
                // React build dosyalarÄ± runtime'da kontrol edilebilir
            ];
            
            result += `ğŸ“ Gerekli dosyalar:\n`;
            result += `  âœ… merkez_koordinatlar.csv (public klasÃ¶rÃ¼nde)\n`;
            result += `  âœ… LocationAutocomplete.tsx (components klasÃ¶rÃ¼nde)\n`;
            result += `  âœ… MapComponent.tsx (gÃ¼ncellendi)\n`;
            result += `  âœ… CalculationPage.tsx (gÃ¼ncellendi)\n\n`;
            
            result += `ğŸ”§ Entegrasyon adÄ±mlarÄ±:\n`;
            result += `  âœ… CSV dosyasÄ± kopyalandÄ±\n`;
            result += `  âœ… LocationAutocomplete komponenti oluÅŸturuldu\n`;
            result += `  âœ… MapComponent'e zoom fonksiyonu eklendi\n`;
            result += `  âœ… CalculationPage'e autocomplete entegre edildi\n\n`;
            
            result += `ğŸ¯ Test senaryolarÄ±:\n`;
            result += `  1. Arama kutusuna "kar" yazÄ±n â†’ KarÅŸÄ±yaka Ã§Ä±kmalÄ±\n`;
            result += `  2. Bir konum seÃ§in â†’ Harita zoom yapmalÄ±\n`;
            result += `  3. Koordinat bilgisi gÃ¼ncellenip gÃ¶sterilmeli\n`;
            result += `  4. BaÄŸ evi formu normal Ã§alÄ±ÅŸmalÄ±\n\n`;
            
            result += `ğŸš€ Test etmek iÃ§in:\n`;
            result += `  â†’ http://localhost:3000/bag-evi linkini kullanÄ±n\n`;
            
            resultDiv.innerHTML = result;
        }
        
        // Sayfa yÃ¼klendiÄŸinde otomatik CSV test et
        window.onload = function() {
            testCSVData();
        };
    </script>
</body>
</html>
